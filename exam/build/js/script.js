$(function(){function o(){$(".jcarousel1").jcarousel(),$(".jcarousel-prev1").click(function(){$(".jcarousel1").jcarousel("scroll","-=1")}),$(".jcarousel-next1").click(function(){$(".jcarousel1").jcarousel("scroll","+=1")})}function c(){$(".jcarousel2").jcarousel(),$(".jcarousel-prev2").click(function(){$(".jcarousel2").jcarousel("scroll","-=1")}),$(".jcarousel-next2").click(function(){$(".jcarousel2").jcarousel("scroll","+=1")})}function t(){$(".jcarousel3").jcarousel(),$(".jcarousel-prev3").click(function(){$(".jcarousel3").jcarousel("scroll","-=1")}),$(".jcarousel-next3").click(function(){$(".jcarousel3").jcarousel("scroll","+=1")})}o(),c(),t()}),$(document).ready(function(){justifiedLayout.loadData(),$("#update").click(justifiedLayout.loadData),$("#tags").keyup(function(o){13==o.keyCode&&$("#update").click()})});var justifiedLayout={};!function(o){var c=420,t=350,a=0,i=null,r=9,l=0;$(window).resize(function(){var o=$("div#picstest").innerWidth();c>o||(a>1.1*o||.9*o>a)&&n()}),o.loadData=function(){i=null,l=0,r=9,$("div#pics").empty(),$("#loading").show();var o=$("#tags").val();$.getJSON("https://api.flickr.com/services/rest/",{method:"flickr.photos.search",api_key:"dbb49a0e2dcc3958834f1b92c072be62",tags:o,tag_mode:"all",extras:"url_n,url_m,url_z,url_l",format:"json",per_page:12,nojsoncallback:1},function(o,c){i=o.photos.photo,n(),$("#loading").hide()})};var e=function(o){return function(){var c="http://www.flickr.com/photos/"+o.owner+"/"+o.id;location.href=c}},n=function(){a=$("div#picstest").innerWidth(),a=Math.max(a,c),l=0,u(i),$("div.picrow").width(a)},u=function(o){if(o){var c=$("div#pics");0===l&&c.empty();var i=a,n=Math.max(t,Math.floor(i/5)),u=5,s=[];$.each(o,function(o,c){var t=parseInt(c.width_n,10),a=parseInt(c.height_n,10);a!=n&&(t=Math.floor(t*(n/a))),s.push(t)});for(var h=0,d=Math.min(r,o.length);d>l;){h++;for(var f=0,p=0;i>1.1*p&&d>l+f;)p+=s[l+f++]+2*u;if(l+f>=d)return;var j=$("<div/>",{"class":"picrow"});c.append(j);var v=i/p,g=0;p=0;var m=Math.floor(n*v);for(j.height(m+2*u);f>g;){var w=o[l+g],_=Math.floor(s[l+g]*v);p+=_+2*u;var k=w.url_n;(_>1.2*w.width_n||m>1.2*w.height_n)&&(k=w.url_m),(_>1.2*w.width_m||m>1.2*w.height_m)&&(k=w.url_z),(_>1.2*w.width_z||m>1.2*w.height_z)&&(k=w.url_l);var y=$("<img/>",{"class":"photo",src:k,width:_,height:m}).css("margin",u+"px");y.click(e(w)),j.append(y),g++}for(l+=f,g=0;i>p;){var x=j.find("img:nth-child("+(g+1)+")");x.width(x.width()+1),g=(g+1)%f,p++}for(g=0;p>i;){var M=j.find("img:nth-child("+(g+1)+")");M.width(M.width()-1),g=(g+1)%f,p--}}}}}(justifiedLayout);